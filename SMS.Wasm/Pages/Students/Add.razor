@page "/students/add"
@inject NavigationManager NavigationManager
@inject StudentService Service
@inject IToastService toastService

<h3 class="mt-4 mb-4">Add Student</h3>
<StudentForm Student="Student" OnSave="OnAddStudent" OnCancel="OnCancelAddStudent" />

@code {
    public StudentDto Student { get; set; } = new StudentDto();

    private async Task OnAddStudent(StudentDto dto)
    {
        var s = await Service.AddStudent(dto); 
        s.Match(
            s => {
                NavigationManager.NavigateTo("students");
                toastService.ShowSuccess("Student added successfully");
             },
            e => {
                //toastService.ShowError(e.Errors.Aggregate((result, item) => result + " " + item));
                toastService.ShowToast(ToastLevel.Error, GenerateErrorFragment(e));
            }
        );       
    }
    RenderFragment GenerateErrorFragment(ErrorResponse e)
    {
        RenderFragment f = b =>
        {
            foreach(var e in e.Errors) { 
                b.OpenElement(1, "div");
                b.AddContent(2, e);
                b.CloseElement();
            }
        };
        return f;
    }
    
    private void OnCancelAddStudent()
    {        
         NavigationManager.NavigateTo("students");
         //toastService.ShowInfo("Add student cancelled");
    }
}